"use strict";(self.webpackChunkscd=self.webpackChunkscd||[]).push([[32],{1032:(ae,h,p)=>{p.r(h),p.d(h,{AdminModule:()=>oe});var u=p(6895),m=p(3659),a=p(433),r=p(8256),g=p(5830),f=p(7556);function b(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"tr")(1,"td"),r._uU(2),r.qZA(),r.TgZ(3,"td")(4,"div",9)(5,"input",10),r.NdJ("click",function(){const s=r.CHM(e).$implicit,c=r.oxw(2);return r.KtG(c.onToggleGrants(c.currentGrant.id,s[0],s[1]))}),r.qZA(),r._UZ(6,"label",11),r.qZA()()()}if(2&t){const e=i.$implicit,n=i.index,o=r.oxw(2);r.xp6(2),r.hij(" ",e[2]," "),r.xp6(2),r.Q6J("ngClass","admin"!=o.role?"locked":""),r.xp6(1),r.MGl("id","slide",n,""),r.Q6J("checked",1==e[1])("disabled","admin"!=o.role),r.xp6(1),r.MGl("for","slide",n,"")}}function T(t,i){if(1&t&&(r.TgZ(0,"tbody"),r.YNc(1,b,7,6,"tr",8),r.qZA()),2&t){const e=r.oxw();r.xp6(1),r.Q6J("ngForOf",e.currentGrantArray)}}let v=(()=>{class t{constructor(e,n){this.apiService=e,this.authService=n,this.partenaireId=0,this.structureId=0,this.role="",this.userId=0,this.selectedGrants={id:0,membersread:0,memberswrite:0,membersadd:0,membersupdate:0,membersproductsadd:0,memberspaymentscheduleread:0,membersstatsread:0,memberssubscriptionread:0,paymentschedulesread:0,paymentscheduleswrite:0,paymentdayread:0,drinksell:0,foodsell:0,sendnewsletter:0}}sexeGerant(e){return"f"==e.toLowerCase()?"Mme":"M."}fullText(e){switch(e){case"membersread":return"Lire les membres";case"memberswrite":return"Ecrire aux membres";case"membersadd":return"Ajouter un membre";case"membersupdate":return"Mettre \xe0 jour un membre";case"membersproductsadd":return"Ajouter un produit \xe0 un membre";case"memberspaymentscheduleread":return"Voir les \xe9ch\xe9ances d'un membre";case"membersstatsread":return"Voir les statistiques des membres";case"memberssubscriptionread":return"Voir les abonnements des membres";case"paymentschedulesread":return"Lire les \xe9ch\xe9ances de virements";case"paymentscheduleswrite":return"Ecrire les \xe9ch\xe9ances de virements";case"paymentdayread":return"Lire le jour de paiement";case"drinksell":return"Vendre des boissons";case"foodsell":return"Vendre de la nourriture";case"sendnewsletter":return"Envoyer des newsletters";default:return""}}ngOnInit(){""!=this.authService.getRole()&&(this.role=this.authService.getRole()),""!=this.authService.getId()&&(this.userId=Number(this.authService.getId()));const e=this.partenaire?this.partenaire.grants??0:this.structure.grants??0;this.partenaireId=this.partenaire?this.partenaire.id:this.structure?this.structure.partenaire:0,this.structureId=this.structure?this.structure.id:0,this.apiService.readGrants(e).subscribe(n=>{this.grants=n,this.currentGrant=this.grants[0],this.currentGrantArray=Object.entries(this.currentGrant),this.currentGrantArray=this.currentGrantArray.filter(function(o){return"id"!==o[0]}),this.currentGrantArray=this.currentGrantArray.map(o=>(o.push(this.fullText(o[0])),o))})}onToggleGrants(e,n,o=0){"admin"==this.role?this.apiService.updateOneGrant(e,n,o=0==o?1:0).subscribe({next:s=>{this.ngOnInit();let c=0==o?"d\xe9sactiv\xe9":"activ\xe9",l=0==this.structureId?'votre compte "partenaire"':"la structure g\xe9r\xe9e par "+this.sexeGerant(this.structure.sexegerant)+" "+this.structure.nomgerant+" situ\xe9e \xe0 l'adresse suivante :<br/>\n"+this.structure.adr1+" "+this.structure.adr2+" \xe0 "+this.structure.ville,d={id:0,titre:"Droit "+c,corps:"Cher partenaire, nous vous informons que le droit <b>"+this.fullText(n).toUpperCase()+"</b> a \xe9t\xe9 <b>"+c+"</b> concernant "+l,lien:"",lu:0,partenaire:this.partenaireId};this.apiService.createMail(d).subscribe({next:_=>{},error:_=>{console.log("Erreur lors de cr\xe9ation de mail",_)}})},error:s=>{console.error("There was an error!",s)}}):alert("Votre action ne peut pas \xeatre prise en compte si vous n'\xeates pas un administrateur.")}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(g.s),r.Y36(f.e))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-grants"]],inputs:{partenaire:"partenaire",structure:"structure"},decls:14,vars:1,consts:[[1,"container","py-5"],[1,"row"],[1,"col-12","col-lg-8","mx-auto"],[1,"display-5","text-dark"],[1,"bg-dark","mb-5"],[1,"table"],["scope","col"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"slideButton",3,"ngClass"],["type","checkbox","value","d","name","check",3,"id","checked","disabled","click"],[3,"for"]],template:function(e,n){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),r._uU(4,"Droits"),r.qZA(),r._UZ(5,"hr",4),r.TgZ(6,"table",5)(7,"thead")(8,"tr")(9,"th",6),r._uU(10,"Droit"),r.qZA(),r.TgZ(11,"th",6),r._uU(12,"ON/OFF"),r.qZA()()(),r.YNc(13,T,2,1,"tbody",7),r.qZA()()()()),2&e&&(r.xp6(13),r.Q6J("ngIf",n.currentGrantArray&&n.currentGrant&&n.currentGrant.id))},dependencies:[u.mk,u.sg,u.O5],styles:['.grantoff[_ngcontent-%COMP%]{background-color:#f08080}.granton[_ngcontent-%COMP%]{background-color:#90ee90}.slideButton[_ngcontent-%COMP%]{width:80px;height:26px;background:#333;margin:20px auto;position:relative;border-radius:50px;box-shadow:inset 0 1px 1px #00000080,0 1px #fff3}.slideButton[_ngcontent-%COMP%]:after{content:"OFF";color:var(--inactiveColor);position:absolute;right:10px;z-index:0;font:12px/26px Arial,sans-serif;font-weight:700;text-shadow:1px 1px 0px rgba(255,255,255,.15)}.slideButton[_ngcontent-%COMP%]:before{content:"ON";color:var(--activeColor);position:absolute;left:10px;z-index:0;font:12px/26px Arial,sans-serif;font-weight:700}.slideButton[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;width:34px;height:20px;cursor:pointer;position:absolute;top:3px;left:3px;z-index:1;background:#fcfff4;background:linear-gradient(to bottom,#fcfff4 0%,#dfe5d7 40%,#b3bead 100%);border-radius:50px;transition:all .4s ease;box-shadow:0 2px 5px #0000004d}.slideButton[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{visibility:hidden}.slideButton[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{left:43px}.locked[_ngcontent-%COMP%]{pointer-events:none;cursor:disabled}']}),t})();const C=function(){return["../../../partenaires"]};function Z(t,i){1&t&&(r.TgZ(0,"a",13),r._uU(1,"\u226a Partenaires"),r.qZA()),2&t&&r.Q6J("routerLink",r.DdM(1,C))}const F=function(){return["../partenaires"]};function A(t,i){1&t&&(r.TgZ(0,"a",13),r._uU(1,"\u226a Partenaires"),r.qZA()),2&t&&r.Q6J("routerLink",r.DdM(1,F))}function w(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",16),r._uU(1," Ajouter une structure "),r.TgZ(2,"img",17),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.toggleDisplayCreateStructureForm())}),r.qZA()()}}function I(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir une adresse"),r.qZA())}function S(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function y(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 60 caract\xe8res"),r.qZA())}function k(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,I,2,0,"span",54),r.YNc(2,S,2,0,"span",54),r.YNc(3,y,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.adr1.errors?null:e.structureForm.controls.adr1.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.adr1.errors?null:e.structureForm.controls.adr1.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.adr1.errors?null:e.structureForm.controls.adr1.errors.maxlength)}}function q(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function U(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 60 caract\xe8res"),r.qZA())}function M(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,q,2,0,"span",54),r.YNc(2,U,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.adr2.errors?null:e.structureForm.controls.adr2.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.adr2.errors?null:e.structureForm.controls.adr2.errors.maxlength)}}function N(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Saisir un code postal \xe0 5 chiffres"),r.qZA())}function P(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,N,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",e.structureForm.controls.cp.invalid)}}function J(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir 'f' ou 'm'"),r.qZA())}function Q(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function Y(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function E(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,J,2,0,"span",54),r.YNc(2,Q,2,0,"span",54),r.YNc(3,Y,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.ville.errors?null:e.structureForm.controls.ville.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.ville.errors?null:e.structureForm.controls.ville.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.ville.errors?null:e.structureForm.controls.ville.errors.maxlength)}}function O(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir 'f' ou 'm'"),r.qZA())}function G(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 1 caract\xe8re"),r.qZA())}function L(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 1 caract\xe8re"),r.qZA())}function D(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,O,2,0,"span",54),r.YNc(2,G,2,0,"span",54),r.YNc(3,L,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.sexegerant.errors?null:e.structureForm.controls.sexegerant.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.sexegerant.errors?null:e.structureForm.controls.sexegerant.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.sexegerant.errors?null:e.structureForm.controls.sexegerant.errors.maxlength)}}function B(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un nom de g\xe9rant(e)"),r.qZA())}function j(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function H(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function R(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,B,2,0,"span",54),r.YNc(2,j,2,0,"span",54),r.YNc(3,H,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.nomgerant.errors?null:e.structureForm.controls.nomgerant.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.nomgerant.errors?null:e.structureForm.controls.nomgerant.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.nomgerant.errors?null:e.structureForm.controls.nomgerant.errors.maxlength)}}function $(t,i){1&t&&(r.TgZ(0,"span",55),r._uU(1," adresse mail valide svp - exemple : jean@gmail.com"),r.qZA())}function K(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir une adresse mail valide"),r.qZA())}function V(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Adresse mail invalide"),r.qZA())}function z(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function X(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,K,2,0,"span",54),r.YNc(2,V,2,0,"span",54),r.YNc(3,z,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.mail.errors?null:e.structureForm.controls.mail.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.mail.errors?null:e.structureForm.controls.mail.errors.email),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.mail.errors?null:e.structureForm.controls.mail.errors.maxlength)}}function W(t,i){if(1&t&&(r.TgZ(0,"div",27)(1,"label",56),r._uU(2,"Mot de passe"),r.qZA(),r._UZ(3,"input",57),r.qZA()),2&t){const e=r.oxw(3);r.xp6(3),r.Q6J("ngClass",e.structureForm.value.id?"noUpdate":"")}}function rr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un mot de passe"),r.qZA())}function er(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 8 caract\xe8res"),r.qZA())}function tr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function nr(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,rr,2,0,"span",54),r.YNc(2,er,2,0,"span",54),r.YNc(3,tr,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.password.errors?null:e.structureForm.controls.password.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.password.errors?null:e.structureForm.controls.password.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.password.errors?null:e.structureForm.controls.password.errors.maxlength)}}function ir(t,i){if(1&t&&(r.TgZ(0,"div",27)(1,"label",58),r._uU(2,"Confirmez le mot de passe"),r.qZA(),r._UZ(3,"input",59),r.qZA()),2&t){const e=r.oxw(3);r.xp6(3),r.Q6J("ngClass",e.structureForm.value.id?"noUpdate":"")}}function or(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un mot de passe"),r.qZA())}function ar(t,i){if(1&t&&(r.TgZ(0,"div",53),r.YNc(1,or,2,0,"span",54),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.structureForm.controls.passwordConfirm.errors?null:e.structureForm.controls.passwordConfirm.errors.required)}}function sr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21)(4,"img",22),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.toggleDisplayCreateStructureForm())}),r.qZA()(),r.TgZ(5,"h2",23),r._uU(6),r.qZA(),r._UZ(7,"hr",24),r.TgZ(8,"form",25),r.NdJ("ngSubmit",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.onSubmitStructureForm())}),r._UZ(9,"input",26),r.TgZ(10,"div",27)(11,"label",28),r._uU(12,"Adresse (n\xb0 et voie)"),r.qZA(),r._UZ(13,"input",29),r.qZA(),r.YNc(14,k,4,3,"div",30),r.TgZ(15,"div",27)(16,"label",31),r._uU(17,"Adresse (suite) "),r.TgZ(18,"em"),r._uU(19,"(non-obligatoire)"),r.qZA()(),r._UZ(20,"input",32),r.qZA(),r.YNc(21,M,3,2,"div",30),r.TgZ(22,"div",27)(23,"label",33),r._uU(24,"Code Postal"),r.qZA(),r._UZ(25,"input",34),r.qZA(),r.YNc(26,P,2,1,"div",30),r.TgZ(27,"div",27)(28,"label",35),r._uU(29,"Ville"),r.qZA(),r._UZ(30,"input",36),r.qZA(),r.YNc(31,E,4,3,"div",30),r.TgZ(32,"div",27)(33,"label",37),r._uU(34,"Sexe G\xe9rant"),r.qZA(),r._UZ(35,"input",38),r.qZA(),r.YNc(36,D,4,3,"div",30),r.TgZ(37,"div",27)(38,"label",39),r._uU(39,"G\xe9rant"),r.qZA(),r._UZ(40,"input",40),r.qZA(),r.YNc(41,R,4,3,"div",30),r.TgZ(42,"div",27)(43,"label",41),r._uU(44,"Mail"),r.qZA(),r.YNc(45,$,2,0,"span",42),r._UZ(46,"input",43),r.qZA(),r.YNc(47,X,4,3,"div",30),r.YNc(48,W,4,1,"div",44),r.YNc(49,nr,4,3,"div",30),r.YNc(50,ir,4,1,"div",44),r.YNc(51,ar,2,1,"div",30),r.TgZ(52,"div",45)(53,"b"),r._uU(54,"Actif"),r.qZA(),r.TgZ(55,"div",46)(56,"div"),r._UZ(57,"input",47),r.TgZ(58,"label",48),r._uU(59,"Actif"),r.qZA()()()(),r.TgZ(60,"div",49),r._UZ(61,"input",50)(62,"input",51),r.TgZ(63,"button",52),r._uU(64,"Enregistrer"),r.qZA()()()()()()}if(2&t){const e=r.oxw(2);r.xp6(6),r.hij(" ",e.titrePage," "),r.xp6(2),r.Q6J("formGroup",e.structureForm),r.xp6(6),r.Q6J("ngIf",e.structureForm.controls.adr1.errors&&e.structureForm.controls.adr1.touched),r.xp6(7),r.Q6J("ngIf",e.structureForm.controls.adr2.errors&&e.structureForm.controls.adr2.touched),r.xp6(5),r.Q6J("ngIf",e.structureForm.controls.cp.errors&&e.structureForm.controls.cp.touched),r.xp6(5),r.Q6J("ngIf",e.structureForm.controls.ville.errors&&e.structureForm.controls.ville.touched),r.xp6(5),r.Q6J("ngIf",e.structureForm.controls.sexegerant.errors&&e.structureForm.controls.sexegerant.touched),r.xp6(5),r.Q6J("ngIf",e.structureForm.controls.nomgerant.errors&&e.structureForm.controls.nomgerant.touched),r.xp6(4),r.Q6J("ngIf",e.structureForm.controls.mail.invalid),r.xp6(2),r.Q6J("ngIf",e.structureForm.controls.mail.errors&&e.structureForm.controls.mail.touched),r.xp6(1),r.Q6J("ngIf",!e.structureForm.value.id),r.xp6(1),r.Q6J("ngIf",!e.structureForm.value.id&&e.structureForm.controls.password.errors&&e.structureForm.controls.password.touched),r.xp6(1),r.Q6J("ngIf",!e.structureForm.value.id),r.xp6(1),r.Q6J("ngIf",!e.structureForm.value.id&&e.structureForm.controls.passwordConfirm.errors&&e.structureForm.controls.passwordConfirm.touched),r.xp6(1),r.Q6J("ngClass",0==e.caseACocherActif?"locked":""),r.xp6(11),r.Q6J("disabled",e.structureForm.invalid||e.structureForm.value.password!==e.structureForm.value.passwordConfirm)}}function cr(t,i){if(1&t&&(r.TgZ(0,"div",9),r.YNc(1,w,3,0,"div",14),r.YNc(2,sr,65,16,"div",15),r.qZA()),2&t){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",0==e.displayCreateStructureForm),r.xp6(1),r.Q6J("ngIf",1==e.displayCreateStructureForm)}}function ur(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"p",64)(1,"button",67),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onEditStructure(o))}),r._uU(2,"Modifier"),r.qZA(),r.TgZ(3,"button",69),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onDeleteStructure(o.id))}),r._uU(4,"Supprimer"),r.qZA()()}}function lr(t,i){1&t&&r._UZ(0,"hr")}function pr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"button",70),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onToggleStructureActif(o.id.toString(),o.actif))}),r._uU(1),r.qZA()}if(2&t){const e=r.oxw().$implicit;r.Q6J("ngClass",1==e.actif?"btn-success":"btn-danger"),r.xp6(1),r.hij(" ",1==e.actif?"D\xe9sactiver":"Activer"," ")}}function dr(t,i){if(1&t&&r._UZ(0,"app-grants",71),2&t){const e=r.oxw().$implicit;r.Q6J("structure",e)}}function mr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",60)(1,"div",61)(2,"div",62)(3,"h5",63),r._uU(4),r.qZA(),r.TgZ(5,"p",64),r._uU(6," Adresse"),r._UZ(7,"br"),r._uU(8),r._UZ(9,"br"),r._uU(10),r._UZ(11,"br"),r._uU(12),r.ALo(13,"uppercase"),r._UZ(14,"br")(15,"br"),r._uU(16),r._UZ(17,"br"),r._uU(18),r.qZA(),r._UZ(19,"hr"),r.YNc(20,ur,5,0,"p",65),r.YNc(21,lr,1,0,"hr",54),r.YNc(22,pr,2,2,"button",66),r.TgZ(23,"button",67),r.NdJ("click",function(){const s=r.CHM(e).$implicit,c=r.oxw();return r.KtG(c.onToggleGrantsForm(s.id))}),r._uU(24),r.qZA()(),r.YNc(25,dr,1,1,"app-grants",68),r.qZA()()}if(2&t){const e=i.$implicit,n=r.oxw();r.xp6(1),r.Q6J("ngClass",1==e.actif?"structure-actif":"structure-inactif"),r.xp6(3),r.Oqu(e.id),r.xp6(4),r.hij(" ",e.adr1,""),r.xp6(2),r.hij(" ",e.adr2,""),r.xp6(2),r.AsE(" ",e.cp," ",r.lcZ(13,14,e.ville),""),r.xp6(4),r.AsE(" ","F"===(null==e.sexegerant?null:e.sexegerant.toUpperCase())?"Mme":"M."," ",e.nomgerant,""),r.xp6(2),r.hij(" ",e.mail," "),r.xp6(2),r.Q6J("ngIf","admin"==n.role),r.xp6(1),r.Q6J("ngIf","admin"==n.role),r.xp6(1),r.Q6J("ngIf","admin"==n.role),r.xp6(2),r.hij(" ",n.grantsFormToggle==e.id?"-":"+"," "),r.xp6(1),r.Q6J("ngIf",n.grantsFormToggle&&n.grantsFormToggle==e.id)}}let x=(()=>{class t{constructor(e,n,o,s){this.activatedRoute=e,this.apiService=n,this.formBuilder=o,this.authService=s,this.structures=[],this.structuresToDisplay=[],this.role="",this.userId=0,this.caseACocherActif=0,this.displayCreateStructureForm=!1,this.titrePage="Enregistrer une nouvelle structure",this.sousTitrePage="Toutes les structures",this.grantsFormToggle=0}ngOnInit(){""!=this.authService.getRole()&&(this.role=this.authService.getRole()),""!=this.authService.getId()&&(this.userId=Number(this.authService.getId())),this.partenaireId=Number(this.activatedRoute.snapshot.paramMap.get("partenaireId")),this.partenaireNomFranchise=this.activatedRoute.snapshot.paramMap.get("partenaireNomFranchise"),"admin"==this.role?(this.initStructureForm(),this.subscription=0!==this.partenaireId?this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(e=>{this.structures=e,this.structuresToDisplay=e,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise}):this.apiService.readStructureAll().subscribe(e=>{this.structures=e,this.structuresToDisplay=e})):"partenaire"==this.role&&0!==this.partenaireId&&(this.subscription=this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(e=>{e=e.filter(n=>1==n.actif),this.structures=e,this.structuresToDisplay=e,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise}))}initStructureForm(){this.structureForm=this.formBuilder.group({id:[0],adr1:["2\xe8me \xe9tage",[a.kI.required,a.kI.minLength(2),a.kI.maxLength(60)]],adr2:["3, rue des pr\xe9s",[a.kI.minLength(2),a.kI.maxLength(60)]],cp:["75003",[a.kI.required,a.kI.minLength(5),a.kI.maxLength(5),a.kI.pattern("[0-9]{5}")]],ville:["PARIS",[a.kI.required,a.kI.minLength(2),a.kI.maxLength(45)]],sexegerant:["F",[a.kI.required,a.kI.minLength(1),a.kI.maxLength(1)]],nomgerant:["Gineste",[a.kI.required,a.kI.minLength(2),a.kI.maxLength(45)]],mail:["gigi@yahoo.fr",[a.kI.required,a.kI.email,a.kI.maxLength(45)]],password:["mlkjmlkj",[a.kI.required,a.kI.minLength(8),a.kI.maxLength(256)]],actif:[!1],grants:["1"],partenaire:[this.partenaireId??0],passwordConfirm:["mlkjmlkj",[a.kI.required]]})}toggleDisplayCreateStructureForm(){this.displayCreateStructureForm=!this.displayCreateStructureForm,this.displayCreateStructureForm||(this.caseACocherActif=0,this.titrePage="Enregistrer une nouvelle structure")}onEditStructure(e){this.grantsFormToggle=0,this.caseACocherActif=1,this.titrePage="Modifier une structure",this.displayCreateStructureForm=!0,this.structureForm.setValue({id:e.id??"",adr1:e.adr1??"",adr2:e.adr2??"",cp:e.cp??"",ville:e.ville??"",sexegerant:e.sexegerant??"M",nomgerant:e.nomgerant??"",mail:e.mail,password:e.password,passwordConfirm:e.password,actif:0!=e.actif,grants:e.grants??0,partenaire:e.partenaire??null}),window.scrollTo({top:0,left:0,behavior:"smooth"})}onToggleStructureActif(e,n){Swal.fire({title:1==n?"Confirmer la d\xe9sactivation ?":"Confirmer l'activation ?",text:"",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Annuler",confirmButtonText:"Oui, "+(1==n?"d\xe9sactiver !":"activer !")}).then(c=>{c.isConfirmed&&(n=1==n?0:1,this.structureForm.reset(),this.structureForm.controls.partenaire.setValue(this.partenaireId),this.apiService.updateStructureActif(e,n).subscribe({next:l=>{this.subscription=this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(d=>{this.structures=d,this.structuresToDisplay=d,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise})},error:l=>{console.error("There was an error!",l)}}))})}sexeGerant(e){return"f"==e.toLowerCase()?"Mme":"M."}onSubmitStructureForm(){const e=this.structureForm.value.id;let n=this.structureForm.value;!e||e&&0==e?(n.id="",delete n.passwordConfirm,this.apiService.createStructure(n).subscribe({next:o=>{this.subscription=this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(c=>{this.structures=c,this.structuresToDisplay=c,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise});let s="la structure g\xe9r\xe9e par "+this.sexeGerant(n.sexegerant)+" "+n.nomgerant+" situ\xe9e \xe0 l'adresse suivante :<br><b>\n"+n.adr1+" "+n.adr2+" \xe0 "+n.ville+"</b>";this.subscription=this.apiService.readLastStructureOfPartenaire(this.partenaireId).subscribe(c=>{let l=c[0].id?.toString(),d={id:0,titre:"Structure cr\xe9\xe9e, \xe0 activer. G\xe9r\xe9e par "+this.sexeGerant(n.sexegerant)+" "+n.nomgerant,corps:"Cher partenaire, nous vous informons que "+s+" a \xe9t\xe9 cr\xe9\xe9e. Pour l'activer, merci de cliquer sur le bouton ci-dessous.",lien:l,lu:0,partenaire:n.partenaire};this.apiService.createMail(d).subscribe({next:_=>{},error:_=>{console.log("Erreur lors de cr\xe9ation de mail",_)}})})},error:o=>{console.error("There was an error!",o)}})):(delete n.passwordConfirm,this.apiService.updateStructure(e,n).subscribe({next:o=>{this.subscription=this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(s=>{this.structures=s,this.structuresToDisplay=s,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise})},error:o=>{console.error("There was an error!",o)}})),this.structureForm.reset(),this.caseACocherActif=0,this.structureForm.controls.partenaire.setValue(this.partenaireId),this.titrePage="Enregistrer une nouvelle structure",this.displayCreateStructureForm=!1}onDeleteStructure(e){this.grantsFormToggle=0,Swal.fire({title:"Etes-vous s\xfbr(e) de vouloir effacer cette structure ?",text:"Cette op\xe9ration est irr\xe9versible !",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Annuler",confirmButtonText:"Oui, effacer !"}).then(n=>{n.isConfirmed&&(e&&0!=e?this.apiService.deleteStructure(e).subscribe(o=>{this.subscription=this.apiService.readStructuresOfPartenaire(this.partenaireId).subscribe(s=>{this.structures=s,this.structuresToDisplay=s,this.sousTitrePage="Structure(s) du partenaire "+this.partenaireNomFranchise})}):console.error("Un id doit \xeatre fourni pour pouvoir supprimer cette structure."))})}onToggleGrantsForm(e=0){this.grantsFormToggle=this.grantsFormToggle==e?0:e}onChangeSeekStructure(e){if(e.target.value.length>=2){let n=e.target.value.toLowerCase();this.structuresToDisplay=this.structures,this.structuresToDisplay.length>0&&(this.structuresToDisplay=this.structuresToDisplay.filter(o=>(console.log(o.mail.search(n)),o.mail.toLowerCase().search(n)>=0||o.adr1.toLowerCase().search(n)>=0||o.adr2.toLowerCase().search(n)>=0||o.cp.toLowerCase().search(n)>=0||o.ville.toLowerCase().search(n)>=0||o.nomgerant.toLowerCase().search(n)>=0)))}else this.structuresToDisplay=this.structures}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(m.gz),r.Y36(g.s),r.Y36(a.qu),r.Y36(f.e))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-structure"]],decls:19,vars:5,consts:[["class","nav-link","routerLinkActive","active-link",3,"routerLink",4,"ngIf"],[1,"container","py-1"],[1,"col-12","col-md-6"],[1,"row","align-items-end"],[1,"col-10","input-group"],[1,"input-group-text"],["src","../assets/search.svg"],["type","text","id","seekstructure","name","seekstructure","maxlength","40","placeholder","minimum 2 caract\xe8res",1,"form-control",3,"keyup"],["class","container py-5",4,"ngIf"],[1,"container","py-5"],[1,"display-5","mb-5"],[1,"row"],["class","col-12 col-md-6 col-lg-4 col-xxl-3 py-2",4,"ngFor","ngForOf"],["routerLinkActive","active-link",1,"nav-link",3,"routerLink"],["class","col-12 col-md-10 col-lg-8 col-xl-6 mx-auto d-flex justify-content-end",4,"ngIf"],["class","row mb-5",4,"ngIf"],[1,"col-12","col-md-10","col-lg-8","col-xl-6","mx-auto","d-flex","justify-content-end"],["src","../assets/plus-circle.svg","width","30",1,"mx-3","img-link",3,"click"],[1,"row","mb-5"],[1,"col-12","col-md-10","col-lg-8","col-xl-6","mx-auto"],[1,"bg-white","shadow","rounded","p-4"],[1,"d-flex","justify-content-end"],["src","../assets/dash-circle.svg","width","30",1,"img-link",3,"click"],[1,"display-5","text-dark"],[1,"bg-dark","mb-5"],[3,"formGroup","ngSubmit"],["type","text","formControlName","id","hidden",""],[1,"form-group","mb-3"],["for","adr1"],["type","text","id","adr1","maxlength","60","formControlName","adr1",1,"form-control"],["class","alert alert-danger","role","alert",4,"ngIf"],["for","adr2"],["type","text","id","adr2","maxlength","60","formControlName","adr2",1,"form-control"],["for","cp"],["type","text","id","cp","formControlName","cp","maxlength","5",1,"form-control"],["for","ville"],["type","text","id","ville","maxlength","45","formControlName","ville","appUppercaseInput","",1,"form-control"],["for","sexegerant"],["type","text","id","sexegerant","maxlength","1","formControlName","sexegerant",1,"form-control"],["for","nomgerant"],["type","text","id","nomgerant","maxlength","45","formControlName","nomgerant",1,"form-control"],["for","mail"],["class","fieldAlert",4,"ngIf"],["type","email","id","mail","maxlength","45","formControlName","mail",1,"form-control"],["class","form-group mb-3",4,"ngIf"],[1,"form-group","mb-3",3,"ngClass"],[1,"form-check"],["type","checkbox","id","actif","formControlName","actif",1,"form-check-input"],["for","actif",1,"form-check-label"],[1,"d-flex"],["type","number","id","grants","formControlName","grants","hidden","",1,"form-control"],["type","number","id","partenaire","formControlName","partenaire","hidden","",1,"form-control"],[1,"btn","btn-success","mx-auto",3,"disabled"],["role","alert",1,"alert","alert-danger"],[4,"ngIf"],[1,"fieldAlert"],["for","password"],["type","password","placeholder","Minimum 8 caract\xe8res","id","password","maxlength","45","formControlName","password",1,"form-control",3,"ngClass"],["for","passwordConfirm"],["type","password","placeholder","Minimum 8 caract\xe8res","id","passwordConfirm","maxlength","45","formControlName","passwordConfirm",1,"form-control",3,"ngClass"],[1,"col-12","col-md-6","col-lg-4","col-xxl-3","py-2"],[1,"card",3,"ngClass"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["class","card-text",4,"ngIf"],["class","btn btn-success","type","button",3,"ngClass","click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],[3,"structure",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-success",3,"ngClass","click"],[3,"structure"]],template:function(e,n){1&e&&(r.TgZ(0,"h1"),r._uU(1,"STRUCTURES"),r.qZA(),r.YNc(2,Z,2,2,"a",0),r._UZ(3,"br"),r.YNc(4,A,2,2,"a",0),r._UZ(5,"br"),r.TgZ(6,"div",1)(7,"div",2)(8,"div",3)(9,"div",4)(10,"div",5),r._UZ(11,"img",6),r.qZA(),r.TgZ(12,"input",7),r.NdJ("keyup",function(s){return n.onChangeSeekStructure(s)}),r.qZA()()()()(),r.YNc(13,cr,3,2,"div",8),r.TgZ(14,"div",9)(15,"h2",10),r._uU(16),r.qZA(),r.TgZ(17,"div",11),r.YNc(18,mr,26,16,"div",12),r.qZA()()),2&e&&(r.xp6(2),r.Q6J("ngIf",n.partenaireId),r.xp6(2),r.Q6J("ngIf",!n.partenaireId),r.xp6(9),r.Q6J("ngIf","admin"==n.role),r.xp6(3),r.Oqu(n.sousTitrePage),r.xp6(2),r.Q6J("ngForOf",n.structuresToDisplay))},dependencies:[u.mk,u.sg,u.O5,m.yS,m.Od,a._Y,a.Fj,a.wV,a.Wl,a.JJ,a.JL,a.nD,a.sg,a.u,v,u.gd],styles:[".no-update[_ngcontent-%COMP%]{background-color:#d3d3d3}button[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}.structure-actif[_ngcontent-%COMP%]{background-color:var(--bgActive)}.structure-inactif[_ngcontent-%COMP%]{background-color:var(--bgInactive)}.locked[_ngcontent-%COMP%]{pointer-events:none;cursor:disabled;color:gray}"]}),t})();function _r(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9)(4,"div",10),r._UZ(5,"img",11),r.qZA(),r.TgZ(6,"input",12),r.NdJ("keyup",function(o){r.CHM(e);const s=r.oxw();return r.KtG(s.onChangeSeekPartenaire(o))}),r.qZA()()()()()}}function gr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",15),r._uU(1," Ajouter un partenaire "),r.TgZ(2,"img",16),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.toggleDisplayCreatePartenaireForm())}),r.qZA()()}}function fr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un nom de franchise"),r.qZA())}function hr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function vr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function xr(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,fr,2,0,"span",46),r.YNc(2,hr,2,0,"span",46),r.YNc(3,vr,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomfranchise.errors?null:e.partenaireForm.controls.nomfranchise.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomfranchise.errors?null:e.partenaireForm.controls.nomfranchise.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomfranchise.errors?null:e.partenaireForm.controls.nomfranchise.errors.maxlength)}}function br(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir 'f' ou 'm'"),r.qZA())}function Tr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 1 caract\xe8re"),r.qZA())}function Cr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 1 caract\xe8re"),r.qZA())}function Zr(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,br,2,0,"span",46),r.YNc(2,Tr,2,0,"span",46),r.YNc(3,Cr,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.sexegerant.errors?null:e.partenaireForm.controls.sexegerant.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.sexegerant.errors?null:e.partenaireForm.controls.sexegerant.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.sexegerant.errors?null:e.partenaireForm.controls.sexegerant.errors.maxlength)}}function Fr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un nom de g\xe9rant(e)"),r.qZA())}function Ar(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 2 caract\xe8res"),r.qZA())}function wr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function Ir(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,Fr,2,0,"span",46),r.YNc(2,Ar,2,0,"span",46),r.YNc(3,wr,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomgerant.errors?null:e.partenaireForm.controls.nomgerant.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomgerant.errors?null:e.partenaireForm.controls.nomgerant.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.nomgerant.errors?null:e.partenaireForm.controls.nomgerant.errors.maxlength)}}function Sr(t,i){1&t&&r._UZ(0,"input",47)}function yr(t,i){1&t&&r._UZ(0,"input",48)}function kr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir une adresse mail valide"),r.qZA())}function qr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Adresse mail invalide"),r.qZA())}function Ur(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function Mr(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,kr,2,0,"span",46),r.YNc(2,qr,2,0,"span",46),r.YNc(3,Ur,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.mail.errors?null:e.partenaireForm.controls.mail.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.mail.errors?null:e.partenaireForm.controls.mail.errors.email),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.mail.errors?null:e.partenaireForm.controls.mail.errors.maxlength)}}function Nr(t,i){if(1&t&&(r.TgZ(0,"div",26)(1,"label",49),r._uU(2,"Mot de passe"),r.qZA(),r._UZ(3,"input",50),r.qZA()),2&t){const e=r.oxw(3);r.xp6(3),r.Q6J("ngClass",e.partenaireForm.value.id?"noUpdate":"")}}function Pr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un mot de passe"),r.qZA())}function Jr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Minimum 8 caract\xe8res"),r.qZA())}function Qr(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Maximum 45 caract\xe8res"),r.qZA())}function Yr(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,Pr,2,0,"span",46),r.YNc(2,Jr,2,0,"span",46),r.YNc(3,Qr,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.password.errors?null:e.partenaireForm.controls.password.errors.required),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.password.errors?null:e.partenaireForm.controls.password.errors.minlength),r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.password.errors?null:e.partenaireForm.controls.password.errors.maxlength)}}function Er(t,i){if(1&t&&(r.TgZ(0,"div",26)(1,"label",51),r._uU(2,"Confirmez le mot de passe"),r.qZA(),r._UZ(3,"input",52),r.qZA()),2&t){const e=r.oxw(3);r.xp6(3),r.Q6J("ngClass",e.partenaireForm.value.id?"noUpdate":"")}}function Or(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1,"Merci de saisir un mot de passe"),r.qZA())}function Gr(t,i){if(1&t&&(r.TgZ(0,"div",45),r.YNc(1,Or,2,0,"span",46),r.qZA()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",null==e.partenaireForm.controls.passwordConfirm.errors?null:e.partenaireForm.controls.passwordConfirm.errors.required)}}function Lr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"img",21),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.toggleDisplayCreatePartenaireForm())}),r.qZA()(),r.TgZ(5,"h2",22),r._uU(6),r.qZA(),r._UZ(7,"hr",23),r.TgZ(8,"form",24),r.NdJ("ngSubmit",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.onSubmitPartenaireForm())}),r._UZ(9,"input",25),r.TgZ(10,"div",26)(11,"label",27),r._uU(12,"NOM FRANCHISE"),r.qZA(),r._UZ(13,"input",28),r.qZA(),r.YNc(14,xr,4,3,"div",29),r.TgZ(15,"div",26)(16,"label",30),r._uU(17,"Sexe G\xe9rant"),r.qZA(),r._UZ(18,"input",31),r.qZA(),r.YNc(19,Zr,4,3,"div",29),r.TgZ(20,"div",26)(21,"label",32),r._uU(22,"G\xe9rant"),r.qZA(),r._UZ(23,"input",33),r.qZA(),r.YNc(24,Ir,4,3,"div",29),r.TgZ(25,"div",26)(26,"label",34),r._uU(27,"Mail"),r.qZA(),r._UZ(28,"input",35),r.YNc(29,Sr,1,0,"input",36),r.YNc(30,yr,1,0,"input",37),r.qZA(),r.YNc(31,Mr,4,3,"div",29),r.YNc(32,Nr,4,1,"div",38),r.YNc(33,Yr,4,3,"div",29),r.YNc(34,Er,4,1,"div",38),r.YNc(35,Gr,2,1,"div",29),r.TgZ(36,"div",26)(37,"b"),r._uU(38,"Actif"),r.qZA(),r.TgZ(39,"div",39)(40,"div"),r._UZ(41,"input",40),r.TgZ(42,"label",41),r._uU(43,"Actif"),r.qZA(),r._UZ(44,"input",42),r.qZA()()(),r.TgZ(45,"div",43)(46,"button",44),r._uU(47,"Enregistrer"),r.qZA()()()()()()}if(2&t){const e=r.oxw(2);r.xp6(6),r.hij(" ",e.titrePage," "),r.xp6(2),r.Q6J("formGroup",e.partenaireForm),r.xp6(6),r.Q6J("ngIf",e.partenaireForm.controls.nomfranchise.errors&&e.partenaireForm.controls.nomfranchise.touched),r.xp6(5),r.Q6J("ngIf",e.partenaireForm.controls.sexegerant.errors&&e.partenaireForm.controls.sexegerant.touched),r.xp6(5),r.Q6J("ngIf",e.partenaireForm.controls.nomgerant.errors&&e.partenaireForm.controls.nomgerant.touched),r.xp6(5),r.Q6J("ngIf",e.partenaireForm.value.id),r.xp6(1),r.Q6J("ngIf",e.partenaireForm.value.id),r.xp6(1),r.Q6J("ngIf",e.partenaireForm.controls.mail.errors&&e.partenaireForm.controls.mail.touched),r.xp6(1),r.Q6J("ngIf",!e.partenaireForm.value.id),r.xp6(1),r.Q6J("ngIf",!e.partenaireForm.value.id&&e.partenaireForm.controls.password.errors&&e.partenaireForm.controls.password.touched),r.xp6(1),r.Q6J("ngIf",!e.partenaireForm.value.id),r.xp6(1),r.Q6J("ngIf",!e.partenaireForm.value.id&&e.partenaireForm.controls.passwordConfirm.errors&&e.partenaireForm.controls.passwordConfirm.touched),r.xp6(11),r.Q6J("disabled",e.partenaireForm.invalid||e.partenaireForm.value.password!==e.partenaireForm.value.passwordConfirm)}}function Dr(t,i){if(1&t&&(r.TgZ(0,"div",2),r.YNc(1,gr,3,0,"div",13),r.YNc(2,Lr,48,13,"div",14),r.qZA()),2&t){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",0==e.displayCreatePartenaireForm),r.xp6(1),r.Q6J("ngIf",1==e.displayCreatePartenaireForm)}}function Br(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"p",58)(1,"button",61),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onEditPartenaire(o))}),r._uU(2,"Modifier"),r.qZA(),r.TgZ(3,"button",63),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onDeletePartenaire(o.id))}),r._uU(4,"Supprimer"),r.qZA()()}}function jr(t,i){1&t&&r._UZ(0,"hr")}function Hr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"button",64),r.NdJ("click",function(){r.CHM(e);const o=r.oxw().$implicit,s=r.oxw();return r.KtG(s.onTogglePartenaireActif(o.id.toString(),o.actif))}),r._uU(1),r.qZA()}if(2&t){const e=r.oxw().$implicit;r.Q6J("ngClass",1==e.actif?"btn-success":"btn-danger"),r.xp6(1),r.hij(" ",1==e.actif?"D\xe9sactiver":"Activer"," ")}}function Rr(t,i){if(1&t&&r._UZ(0,"app-grants",65),2&t){const e=r.oxw().$implicit;r.Q6J("partenaire",e)}}const $r=function(t,i){return["../structures",t,i]};function Kr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",53)(1,"div",54)(2,"div",55)(3,"h5",56),r._uU(4),r.qZA(),r.TgZ(5,"a",57),r._uU(6,"Voir les structures"),r.qZA(),r._UZ(7,"br"),r.TgZ(8,"p",58),r._uU(9),r._UZ(10,"br"),r._uU(11),r._UZ(12,"br"),r._uU(13),r.qZA(),r._UZ(14,"hr"),r.YNc(15,Br,5,0,"p",59),r.YNc(16,jr,1,0,"hr",46),r.YNc(17,Hr,2,2,"button",60),r.TgZ(18,"button",61),r.NdJ("click",function(){const s=r.CHM(e).$implicit,c=r.oxw();return r.KtG(c.onToggleGrantsForm(s.id))}),r._uU(19),r.qZA()(),r.YNc(20,Rr,1,1,"app-grants",62),r.qZA()()}if(2&t){const e=i.$implicit,n=i.index,o=r.oxw();r.xp6(1),r.Q6J("ngClass",1==e.actif?"partenaire-actif":"partenaire-inactif"),r.xp6(3),r.Oqu(e.nomfranchise),r.xp6(1),r.Q6J("routerLink",r.WLB(13,$r,e.id,e.nomfranchise)),r.xp6(4),r.AsE(" N\xb0",n," - #",e.id,""),r.xp6(2),r.AsE(" ","F"===(null==e.sexegerant?null:e.sexegerant.toUpperCase())?"Mme":"M."," ",e.nomgerant,""),r.xp6(2),r.hij(" ",e.mail," "),r.xp6(2),r.Q6J("ngIf","admin"==o.role),r.xp6(1),r.Q6J("ngIf","admin"==o.role),r.xp6(1),r.Q6J("ngIf","admin"==o.role),r.xp6(2),r.hij(" ",o.grantsFormToggle==e.id?"-":"+"," "),r.xp6(1),r.Q6J("ngIf",o.grantsFormToggle&&o.grantsFormToggle==e.id)}}function zr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"button",11),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2).$implicit,s=r.oxw();return r.KtG(s.activeStructure(o.id,o.lien))}),r._uU(1,"Activer la structure"),r.qZA()}}function Xr(t,i){if(1&t&&(r.TgZ(0,"div",8),r._UZ(1,"span",9)(2,"br"),r.YNc(3,zr,2,0,"button",10),r.qZA()),2&t){const e=r.oxw().$implicit;r.xp6(1),r.s9C("innerHtml",e.corps,r.oJD),r.xp6(2),r.Q6J("ngIf",""!=e.lien)}}function Wr(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",3)(1,"div",4)(2,"div",5),r.NdJ("click",function(){const s=r.CHM(e).$implicit,c=r.oxw();return r.KtG(c.toggleDisplayMail(s.id,s.lu))}),r.TgZ(3,"p",6),r._uU(4),r._UZ(5,"br"),r.qZA()(),r.YNc(6,Xr,4,2,"div",7),r.qZA()()}if(2&t){const e=i.$implicit,n=r.oxw();r.xp6(2),r.Q6J("ngClass",0==e.lu?"mail-non-lu":""),r.xp6(2),r.hij(" ",e.titre,""),r.xp6(2),r.Q6J("ngIf",n.displayMailToggle&&n.displayMailToggle==e.id)}}const re=[{path:"",redirectTo:"partenaires",pathMatch:"full"},{path:"partenaires",component:(()=>{class t{constructor(e,n,o){this.apiService=e,this.formBuilder=n,this.authService=o,this.partenaires=[],this.partenairesToDisplay=[],this.role="",this.userId=0,this.displayCreatePartenaireForm=!1,this.titrePage="Enregistrer un nouveau partenaire",this.grantsFormToggle=0}ngOnInit(){""!=this.authService.getRole()&&(this.role=this.authService.getRole()),""!=this.authService.getId()&&(this.userId=Number(this.authService.getId())),"admin"==this.role?(this.initPartenaireForm(),this.subscription=this.apiService.readPartenaireAll().subscribe(e=>{this.partenaires=e,this.partenairesToDisplay=e})):"partenaire"==this.role&&(this.subscription=this.apiService.readPartenaire(Number(this.userId)).subscribe(e=>{this.partenaires=e,this.partenairesToDisplay=e}))}initPartenaireForm(){this.partenaireForm=this.formBuilder.group({id:[0],nomfranchise:["TEST",[a.kI.required,a.kI.minLength(2),a.kI.maxLength(45)]],sexegerant:["M",[a.kI.required,a.kI.minLength(1),a.kI.maxLength(1)]],nomgerant:["Durand",[a.kI.required,a.kI.minLength(2),a.kI.maxLength(45)]],mail:["dudu@gmail.fr",[a.kI.email,a.kI.required,a.kI.maxLength(45)]],password:["qsdfqsdf",[a.kI.required,a.kI.minLength(8),a.kI.maxLength(256)]],actif:[!0],grants:["1"],passwordConfirm:["qsdfqsdf",[a.kI.required]]})}toggleDisplayCreatePartenaireForm(){this.displayCreatePartenaireForm=!this.displayCreatePartenaireForm,this.displayCreatePartenaireForm&&(this.initPartenaireForm(),this.titrePage="Enregistrer un nouveau partenaire")}onEditPartenaire(e){this.grantsFormToggle=0,this.titrePage="Modifier un partenaire",this.displayCreatePartenaireForm=!0,this.partenaireForm.setValue({id:e.id??"",nomfranchise:e.nomfranchise??"",sexegerant:e.sexegerant??"M",nomgerant:e.nomgerant??"",mail:e.mail,password:e.password,passwordConfirm:e.password,actif:0!=e.actif,grants:e.grants??0}),window.scrollTo({top:0,left:0,behavior:"smooth"}),console.log(this.partenaireForm)}onTogglePartenaireActif(e,n){Swal.fire({title:1==n?"Confirmer la d\xe9sactivation ?":"Confirmer l'activation ?",text:"",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Annuler",confirmButtonText:"Oui, "+(1==n?"d\xe9sactiver !":"activer !")}).then(c=>{c.isConfirmed&&(n=1==n?0:1,this.partenaireForm.reset(),this.apiService.updatePartenaireActif(e,n).subscribe({next:l=>{this.subscription=this.apiService.readPartenaireAll().subscribe(d=>{this.partenaires=d,this.partenairesToDisplay=d})},error:l=>{console.error("There was an error!",l)}}))})}onSubmitPartenaireForm(){const e=this.partenaireForm.value.id;let n=this.partenaireForm.value;!e||e&&0==e?(n.id="",delete n.passwordConfirm,this.apiService.createPartenaire(n).subscribe({next:o=>{this.subscription=this.apiService.readPartenaireAll().subscribe(s=>{this.partenaires=s,this.partenairesToDisplay=s})},error:o=>{console.error("There was an error!",o)}})):(delete n.passwordConfirm,this.apiService.updatePartenaire(e,n).subscribe({next:o=>{this.subscription=this.apiService.readPartenaireAll().subscribe(s=>{this.partenaires=s,this.partenairesToDisplay=s})},error:o=>{console.error("There was an error!",o)}})),this.partenaireForm.reset(),this.titrePage="Enregistrer un nouveau partenaire",this.displayCreatePartenaireForm=!1}onDeletePartenaire(e){this.grantsFormToggle=0,Swal.fire({title:"Etes-vous s\xfbr(e) de vouloir effacer ce partenaire ?",text:"Cette op\xe9ration est irr\xe9versible !",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Annuler",confirmButtonText:"Oui, effacer !"}).then(n=>{n.isConfirmed&&(e&&0!=e?this.apiService.deletePartenaire(e).subscribe(o=>{this.subscription=this.apiService.readPartenaireAll().subscribe(s=>{Swal.fire("Effac\xe9 !","Ce partenaire a \xe9t\xe9 effac\xe9","success"),this.partenaires=s,this.partenairesToDisplay=s})}):console.error("Un id doit \xeatre fourni pour pouvoir supprimer ce partenaire."))})}onToggleGrantsForm(e=0){this.grantsFormToggle=this.grantsFormToggle==e?0:e}onChangeSeekPartenaire(e){if(e.target.value.length>=2){let n=e.target.value.toLowerCase();this.partenairesToDisplay=this.partenaires,this.partenairesToDisplay.length>0&&(this.partenairesToDisplay=this.partenairesToDisplay.filter(o=>(console.log(o.mail.search(n)),o.mail.toLowerCase().search(n)>=0||o.nomfranchise.toLowerCase().search(n)>=0||o.nomgerant.toLowerCase().search(n)>=0)))}else this.partenairesToDisplay=this.partenaires}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(g.s),r.Y36(a.qu),r.Y36(f.e))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-partenaire"]],decls:9,vars:3,consts:[["class","container py-1",4,"ngIf"],["class","container py-5",4,"ngIf"],[1,"container","py-5"],[1,"display-5","mb-5"],[1,"row"],["class","col-12 col-md-6 col-lg-4 col-xxl-3 py-2",4,"ngFor","ngForOf"],[1,"container","py-1"],[1,"col-12","col-md-6"],[1,"row","align-items-end"],[1,"col-10","input-group"],[1,"input-group-text"],["src","../assets/search.svg"],["type","text","id","seekpartenaire","name","seekpartenaire","maxlength","40","placeholder","minimum 2 caract\xe8res",1,"form-control",3,"keyup"],["class","col-12 col-md-10 col-lg-8 col-xl-6 mx-auto d-flex justify-content-end",4,"ngIf"],["class","row mb-5",4,"ngIf"],[1,"col-12","col-md-10","col-lg-8","col-xl-6","mx-auto","d-flex","justify-content-end"],["src","../assets/plus-circle.svg","width","30",1,"mx-3","img-link",3,"click"],[1,"row","mb-5"],[1,"col-12","col-md-10","col-lg-8","col-xl-6","mx-auto"],[1,"bg-white","shadow","rounded","p-4"],[1,"d-flex","justify-content-end"],["src","../assets/dash-circle.svg","width","30",1,"img-link",3,"click"],[1,"display-5","text-dark"],[1,"bg-dark","mb-5"],[3,"formGroup","ngSubmit"],["type","text","formControlName","id","hidden",""],[1,"form-group","mb-3"],["for","nomfranchise"],["type","text","id","nomfranchise","maxlength","45","formControlName","nomfranchise","appUppercaseInput","",1,"form-control"],["class","alert alert-danger","role","alert",4,"ngIf"],["for","sexegerant"],["type","text","id","sexegerant","maxlength","1","formControlName","sexegerant",1,"form-control"],["for","nomgerant"],["type","text","id","nomgerant","maxlenght","45","formControlName","nomgerant",1,"form-control"],["for","mail"],["type","mail","id","mail","maxlength","45","formControlName","mail",1,"form-control"],["type","hidden","class","form-control","id","password","formControlName","password",4,"ngIf"],["type","hidden","class","form-control","id","passwordConfirm","formControlName","passwordConfirm",4,"ngIf"],["class","form-group mb-3",4,"ngIf"],[1,"form-check"],["type","checkbox","id","actif","formControlName","actif",1,"form-check-input"],["for","actif",1,"form-check-label"],["type","number","id","grants","formControlName","grants","hidden","",1,"form-control"],[1,"d-flex"],[1,"btn","btn-success","mx-auto",3,"disabled"],["role","alert",1,"alert","alert-danger"],[4,"ngIf"],["type","hidden","id","password","formControlName","password",1,"form-control"],["type","hidden","id","passwordConfirm","formControlName","passwordConfirm",1,"form-control"],["for","password"],["type","password","placeholder","Minimum 8 caract\xe8res","maxlength","45","id","password","formControlName","password",1,"form-control",3,"ngClass"],["for","passwordConfirm"],["type","password","placeholder","Minimum 8 caract\xe8res","id","passwordConfirm","maxlength","45","formControlName","passwordConfirm",1,"form-control",3,"ngClass"],[1,"col-12","col-md-6","col-lg-4","col-xxl-3","py-2"],[1,"card",3,"ngClass"],[1,"card-body"],[1,"card-title"],["routerLinkActive","active-link",1,"nav-link",3,"routerLink"],[1,"card-text"],["class","card-text",4,"ngIf"],["class","btn btn-success","type","button",3,"ngClass","click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],[3,"partenaire",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-success",3,"ngClass","click"],[3,"partenaire"]],template:function(e,n){1&e&&(r.TgZ(0,"h1"),r._uU(1,"PARTENAIRES"),r.qZA(),r.YNc(2,_r,7,0,"div",0),r.YNc(3,Dr,3,2,"div",1),r.TgZ(4,"div",2)(5,"h1",3),r._uU(6,"Tous les partenaires"),r.qZA(),r.TgZ(7,"div",4),r.YNc(8,Kr,21,16,"div",5),r.qZA()()),2&e&&(r.xp6(2),r.Q6J("ngIf","admin"==n.role),r.xp6(1),r.Q6J("ngIf","admin"==n.role),r.xp6(5),r.Q6J("ngForOf",n.partenairesToDisplay))},dependencies:[u.mk,u.sg,u.O5,m.yS,m.Od,a._Y,a.Fj,a.wV,a.Wl,a.JJ,a.JL,a.nD,a.sg,a.u,v],styles:[".no-update[_ngcontent-%COMP%]{background-color:#d3d3d3}button[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}.partenaire-actif[_ngcontent-%COMP%]{background-color:var(--bgActive)}.partenaire-inactif[_ngcontent-%COMP%]{background-color:var(--bgInactive)}"]}),t})()},{path:"structures",component:x},{path:"structures/:partenaireId/:partenaireNomFranchise",component:x},{path:"mails",component:(()=>{class t{constructor(e,n){this.apiService=e,this.authService=n,this.mails=[],this.role="",this.userId=0,this.displayMailToggle=0}ngOnInit(){""!=this.authService.getRole()&&(this.role=this.authService.getRole()),""!=this.authService.getId()&&(this.userId=Number(this.authService.getId())),"partenaire"==this.role&&(this.subscription=this.apiService.readMailsFromPartenaire(this.userId).subscribe(e=>{this.mails=e}))}toggleDisplayMail(e=0,n=0){if(this.displayMailToggle==e)this.displayMailToggle=0;else if(this.displayMailToggle=e,0==n){let o;o=this.mails.find(s=>s.id==e),this.subscription=this.apiService.updateMailLu(e,o).subscribe({next:s=>{this.subscription=this.apiService.readMailsFromPartenaire(this.userId).subscribe(c=>{this.mails=c})},error:s=>{console.error("Erreur lors du marquage du mail LU !",s)}})}}onDisplayOneMail(e){let n;n=this.mails.find(o=>o.id==e),this.apiService.updateMailLu(e,n).subscribe({next:o=>{this.subscription=this.apiService.readMailsFromPartenaire(this.userId).subscribe(s=>{this.mails=s})},error:o=>{console.error("Erreur lors du marquage du mail LU !",o)}})}activeStructure(e,n){Swal.fire({title:"Confirmer l'activation de cette structure ?",text:"",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Annuler",confirmButtonText:"OK"}).then(s=>{s.isConfirmed&&this.apiService.turnOnStructureActifAndDeleteMailLink(n,e).subscribe({next:c=>{this.subscription=this.apiService.readMailsFromPartenaire(this.userId).subscribe(l=>{this.mails=l})},error:c=>{console.error("There was an error!",c)}})})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(g.s),r.Y36(f.e))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-mails"]],decls:5,vars:1,consts:[[1,"container","py-5"],[1,"row"],["class","col-12 py-2",4,"ngFor","ngForOf"],[1,"col-12","py-2"],[1,"card"],[1,"card-body",3,"ngClass","click"],[1,"card-text"],["class","card-body border-top",4,"ngIf"],[1,"card-body","border-top"],[3,"innerHtml"],["type","button","class","btn btn-success my-3",3,"click",4,"ngIf"],["type","button",1,"btn","btn-success","my-3",3,"click"]],template:function(e,n){1&e&&(r.TgZ(0,"h1"),r._uU(1,"MAILS"),r.qZA(),r.TgZ(2,"div",0)(3,"div",1),r.YNc(4,Wr,7,3,"div",2),r.qZA()()),2&e&&(r.xp6(4),r.Q6J("ngForOf",n.mails))},dependencies:[u.mk,u.sg,u.O5],styles:[".mail-non-lu[_ngcontent-%COMP%]{font-weight:700;background-color:#d3d3d3}"]}),t})()},{path:"",redirectTo:"partenaires",pathMatch:"full"},{path:"**",redirectTo:"partenaires"}];let ee=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[m.Bz.forChild(re),m.Bz]}),t})(),te=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[u.ez]}),t})(),ne=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[u.ez]}),t})();var ie=p(9837);let oe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[u.ez,ee,a.u5,a.UX,te,ne,ie.bz]}),t})()}}]);